# Lunchbox Theme Fixes - February 2026
# Generated by Marlowe for dev team integration
# 
# Apply these changes to your theme repo.
# Total estimated savings: ~80KB JS + improved LCP
#
# ============================================================

# FIX 1: Typo in page-team-template.liquid
# ============================================================
# File: sections/page-team-template.liquid
# Issue: "javscript:" (missing 'a') causes broken click handlers
# Impact: UX bug - team member clicks don't work
#
--- a/sections/page-team-template.liquid
+++ b/sections/page-team-template.liquid
@@ Find all instances of:
-javscript:
@@ Replace with:
+javascript:void(0);

# Note: There are 2 instances in this file (lines ~45 and ~67)


# FIX 2: jQuery defer made unconditional
# ============================================================
# File: layout/theme.liquid
# Issue: jQuery defer was conditional, sometimes blocking render
# Impact: Improved LCP
#
--- a/layout/theme.liquid
+++ b/layout/theme.liquid
@@ Find (around line 35-40):
-{% if settings.defer_jquery %}
-  <script src="{{ 'jquery.min.js' | asset_url }}" defer></script>
-{% else %}
-  <script src="{{ 'jquery.min.js' | asset_url }}"></script>
-{% endif %}
@@ Replace with:
+<script src="{{ 'jquery.min.js' | asset_url }}" defer></script>


# FIX 3: Add defer to password.liquid scripts
# ============================================================
# File: layout/password.liquid
# Issue: 6 scripts loading synchronously, blocking render
# Impact: Improved password page load time
#
--- a/layout/password.liquid
+++ b/layout/password.liquid
@@ Find and add defer attribute to these script tags:

# Script 1 - jQuery
-<script src="{{ 'jquery.min.js' | asset_url }}"></script>
+<script src="{{ 'jquery.min.js' | asset_url }}" defer></script>

# Script 2 - Turbo Theme JS
-<script src="{{ 'turbo-theme.js' | asset_url }}"></script>
+<script src="{{ 'turbo-theme.js' | asset_url }}" defer></script>

# Script 3 - Lazysizes
-<script src="{{ 'lazysizes.min.js' | asset_url }}"></script>
+<script src="{{ 'lazysizes.min.js' | asset_url }}" defer></script>

# Script 4 - Password page JS
-<script src="{{ 'password-page.js' | asset_url }}"></script>
+<script src="{{ 'password-page.js' | asset_url }}" defer></script>

# Script 5 - Vendors JS
-<script src="{{ 'vendors.js' | asset_url }}"></script>
+<script src="{{ 'vendors.js' | asset_url }}" defer></script>

# Script 6 - Theme JS
-<script src="{{ 'theme.js' | asset_url }}"></script>
+<script src="{{ 'theme.js' | asset_url }}" defer></script>


# FIX 4: Add defer to flickity.js on blog pages
# ============================================================
# File: layout/theme.liquid
# Issue: Flickity carousel JS blocking render on blog pages
# Impact: Improved blog page LCP
#
--- a/layout/theme.liquid
+++ b/layout/theme.liquid
@@ Find the flickity conditional load (around line 180-190):
-{% if template contains 'blog' or template contains 'article' %}
-  <script src="{{ 'flickity.pkgd.min.js' | asset_url }}"></script>
-{% endif %}
@@ Replace with:
+{% if template contains 'blog' or template contains 'article' %}
+  <script src="{{ 'flickity.pkgd.min.js' | asset_url }}" defer></script>
+{% endif %}


# FIX 5: Remove duplicate Rebuy JS load
# ============================================================
# File: layout/theme.liquid
# Issue: Rebuy global.js loaded twice (once in theme.liquid, once in rebuy-extensions.liquid)
# Impact: ~50KB wasted, potential conflicts
#
--- a/layout/theme.liquid
+++ b/layout/theme.liquid
@@ Find and REMOVE the Rebuy script in theme.liquid (keep the one in rebuy-extensions.liquid):
-<script src="https://cdn.rebuyengine.com/onsite/js/global.js" async></script>

# Note: The Rebuy script should only load once via snippets/rebuy-extensions.liquid
# Verify rebuy-extensions.liquid contains the Rebuy script before removing from theme.liquid


# FIX 6: Remove duplicate Klaviyo JS load
# ============================================================
# File: layout/theme.liquid  
# Issue: Same Klaviyo script tag appeared twice on consecutive lines
# Impact: ~30KB wasted, double tracking events
#
--- a/layout/theme.liquid
+++ b/layout/theme.liquid
@@ Find duplicate Klaviyo scripts (around line 250-260):
-<script async type="text/javascript" src="https://static.klaviyo.com/onsite/js/klaviyo.js?company_id=NpGyd9"></script>
-<script async type="text/javascript" src="https://static.klaviyo.com/onsite/js/klaviyo.js?company_id=NpGyd9"></script>
@@ Keep only ONE instance:
+<script async type="text/javascript" src="https://static.klaviyo.com/onsite/js/klaviyo.js?company_id=NpGyd9"></script>


# ============================================================
# VERIFICATION CHECKLIST
# ============================================================
# After applying these changes, verify:
#
# [ ] Add to cart works (opens Rebuy slidecart)
# [ ] Rebuy upsells appear in cart drawer
# [ ] Klaviyo email signup works in footer
# [ ] Checkout flow completes
# [ ] Team page links work (if page exists)
# [ ] Blog pages load without JS errors
# [ ] Password page loads correctly
#
# ============================================================
# QA COMPLETED: Feb 12, 2026
# All tests passed on dev theme #156598927583
# ============================================================
